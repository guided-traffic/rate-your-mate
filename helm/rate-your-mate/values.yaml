# Default values for rate-your-mate
replicaCount: 1

frontend:
  image:
    repository: docker.io/guidedtraffic/rate-your-mate-frontend
    tag: latest
    pullPolicy: IfNotPresent
  service:
    type: ClusterIP
    port: 8080
  # Extra labels for frontend pods
  extraPodLabels: {}
  resources:
    limits:
      cpu: 200m
      memory: 256Mi
    requests:
      cpu: 100m
      memory: 128Mi

backend:
  image:
    repository: docker.io/guidedtraffic/rate-your-mate-backend
    tag: latest
    pullPolicy: IfNotPresent
  service:
    type: ClusterIP
    port: 8080
  # Extra labels for backend pods
  extraPodLabels: {}
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 250m
      memory: 256Mi
  # Persistent storage for backend data (SQLite database and image cache)
  # Required for SQLite, recommended for MySQL (for game image caching)
  persistence:
    enabled: false
    # Storage class - leave empty for default, set to "-" for no storage class
    storageClass: ""
    # Access mode
    accessMode: ReadWriteOnce
    # Size of the persistent volume
    size: 1Gi
    # Mount path inside the container
    mountPath: /app/data
  env:
    PORT: "8080"
    FRONTEND_URL: "http://localhost:4200"
    BACKEND_URL: "http://localhost:8080"
    JWT_EXPIRATION_DAYS: "7"
    CREDIT_INTERVAL_MINUTES: "10"
    CREDIT_MAX: "10"
    # Comma-separated list of Steam IDs that have admin access
    ADMIN_STEAM_IDS: ""
    # Comma-separated list of Steam App IDs to pin at the top of the games list
    # Find App IDs at https://steamdb.info/ or in Steam Store URLs
    # Examples: 730 (CS2), 252490 (Rust), 4000 (Garry's Mod), 945360 (Among Us)
    PINNED_GAME_IDS: ""
    # Initial countdown target for the login page (RFC3339 format)
    # When the countdown reaches zero, voting pause is automatically lifted
    # Example: "2024-12-31T18:00:00Z" or "2024-12-31T19:00:00+01:00"
    # Leave empty for no countdown (can be set later via Admin Panel)
    COUNTDOWN_TARGET: ""

# Database configuration
database:
  # Database type: "sqlite" or "mysql"
  type: sqlite

  # SQLite configuration (only used when type=sqlite)
  sqlite:
    # Path to the SQLite database file (relative to persistence.mountPath)
    path: /app/data/rate-your-mate.db

  # MySQL configuration (only used when type=mysql)
  mysql:
    # External secret for MySQL credentials
    # Each key can be set individually - if a key is set, that value comes from the secret
    # If a key is empty, the inline value below is used instead
    # This allows hybrid configurations (e.g., user/password from secret, host/port inline)
    existingSecret:
      name: ""
      keys:
        host: ""      # Leave empty to use inline mysql.host
        port: ""      # Leave empty to use inline mysql.port
        user: ""      # e.g., "username" - key in the secret containing the MySQL user
        password: ""  # e.g., "password" - key in the secret containing the MySQL password
        database: ""  # Leave empty to use inline mysql.database

    # Inline MySQL configuration (used when corresponding existingSecret.keys.* is empty)
    host: ""
    port: 3306
    user: ""
    password: ""
    database: "rate-your-mate"

    # TLS configuration
    tls:
      enabled: false
      # Skip hostname verification (still validates against CA)
      skipVerify: false
      # Optional: Secret containing CA certificate
      caSecret:
        name: ""
        key: "ca.crt"

    # Connection pool configuration
    pool:
      maxOpenConns: 25
      maxIdleConns: 5
      connMaxLifetime: "5m"
      connMaxIdleTime: "1m"

secrets:
  # Set to false if you manage secrets externally
  create: true
  # Use an existing secret instead of creating one
  # If set, secrets.create is ignored and this secret is used
  existingSecret: ""
  # Steam Web API Key (required for Steam login)
  # Get yours at: https://steamcommunity.com/dev/apikey
  steamApiKey: ""
  # JWT Secret for token signing (required for authentication)
  # Generate with: openssl rand -base64 32
  jwtSecret: ""
  # Optional: Admin password for additional admin panel security
  # If set, admins must enter this password each time they open the admin panel
  adminPassword: ""

ingress:
  enabled: false
  # Ingress class name (e.g., nginx, hpi-external)
  className: ""
  # Host name for the ingress
  host: lan-party.local
  # Additional annotations
  annotations: {}
    # cert-manager.io/cluster-issuer: letsencrypt-prod
    # kubernetes.io/ingress.class: nginx
  # TLS configuration
  tls:
    enabled: false
    # Secret name for TLS certificate (defaults to <fullname>-tls)
    secretName: ""

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  create: true
  annotations: {}
  name: ""

podAnnotations: {}
# Pod security context - fsGroup ensures mounted volumes are writable by non-root user
podSecurityContext:
  fsGroup: 65532
# Container security context - run as non-root user (distroless default)
securityContext:
  runAsNonRoot: true
  runAsUser: 65532
  runAsGroup: 65532
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: true
  capabilities:
    drop:
      - ALL

nodeSelector: {}
tolerations: []
affinity: {}
